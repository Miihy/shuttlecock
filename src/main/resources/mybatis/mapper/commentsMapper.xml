<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.fp.shuttlecock.comments.CommentsMapper">

	<select id="getCommentList" parameterType="_int"
		resultType="CommentsDTO">
		select * from comments
		<where>
			<choose>
				<when test="tradeboardId != null">
					tradeboardId = #{tradeboardId}
				</when>
				<when test="recruitboardId != null">
					recruitboardId = #{recruitboardId}
				</when>
				<when test="freeboardId != null">
					freeboardId = #{freeboardId}
				</when>
			</choose>
		</where>
	</select>
	
	<insert id="insertComment" parameterType="CommentsDTO">
		INSERT INTO comments(content
		<choose>
			<when test="tradeboardId != null">
				, tradeboardId
			</when>
			<when test="freeboardId != null">
				, freeboardId
			</when>
			<when test="recruitboardId != null">
				, recruitboardId
			</when>
		</choose>
		) VALUES(#{content}
		<choose>
			<when test="tradeboardId != null">
				, #{tradeboardId}
			</when>
			<when test="freeboardId != null">
				, #{freeboardId}
			</when>
			<when test="recruitboardId != null">
				, #{recruitboardId}
			</when>
		</choose>
		)
	</insert>
	
	<update id="increaseCommentCount" parameterType="CommentsDTO">
		<choose>
			<when test="tradeboardId != null">
				update tradeboard 
				set commentCount = commentCount + 1 
				where tradeboardId = #{tradeboardId}
			</when>
			<when test="freeboardId != null">
				update freeboard 
				set commentCount = commentCount + 1 
				where freeboardId = #{freeboardId}
			</when>
			<when test="recruitboardId != null">
				update recruitboard 
				set commentCount = commentCount + 1 
				where recruitboardId = #{recruitboardId}
			</when>
		</choose>
	</update>
	
	<select id="getCommentByCommentsId" parameterType="_int" resultType="CommentsDTO">
		select * from comments where commentsId = #{commentsId}
	</select>
	
	<delete id="deleteComment" parameterType="_int">
		delete from comments where commentsId = #{commentsId}
	</delete>
	
	<update id="updateComment" parameterType="CommentsDTO">
		update comments 
		set content = #{content}, regdate = NOW() 
		where commentsId = #{commentsId} 
	</update>
	
	<select id="getCommentListByTradeboardId" parameterType="_int" resultType="CommentsDTO">
		select * from comments where tradeboardId = #{tradeboardId}
	</select>
	
	<select id="getCommentListByFreeboardId" parameterType="_int" resultType="CommentsDTO">
		select * from comments where freeboardId = #{freeboardId}
	</select>
	
	<select id="getCommentListByRecruitboardId" parameterType="_int" resultType="CommentsDTO">
		select * from comments where recruitboardId = #{recruitboardId}
	</select>
</mapper>