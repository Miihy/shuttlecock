<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.fp.shuttlecock.comments.CommentsMapper">

	<insert id="insertComment" parameterType="CommentsDTO">
		INSERT INTO comments(content, bno, comment_type, userId, secret) 
		values(#{content}, #{bno}, #{comment_type}, #{userId}, #{secret})
	</insert>
	
	<update id="increaseCommentCount" parameterType="CommentsDTO">
		<choose>
			<when test="comment_type == 2">
				update freeboard 
				set commentCount = commentCount + 1 
				where freeboardId = #{bno}
			</when>
			<when test="comment_type == 3">
				update tradeboard 
				set commentCount = commentCount + 1 
				where tradeboardId = #{bno}
			</when>
			<when test="comment_type == 4">
				update recruitboard 
				set commentCount = commentCount + 1 
				where recruitboardId = #{bno}
			</when>
		</choose>
	</update>
	
	<update id="decreaseCommentCount" parameterType="CommentsDTO">
		<choose>
			<when test="comment_type == 2">
				update freeboard 
				set commentCount = commentCount - 1 
				where freeboardId = #{bno}
			</when>
			<when test="comment_type == 3">
				update tradeboard 
				set commentCount = commentCount - 1 
				where tradeboardId = #{bno}
			</when>
			<when test="comment_type == 4">
				update recruitboard 
				set commentCount = commentCount - 1 
				where recruitboardId = #{bno}
			</when>
		</choose>
	</update>
	
	<select id="getCommentByCommentsId" parameterType="_int" resultType="CommentsDTO">
		select * from comments where commentsId = #{commentsId}
	</select>
	
	<delete id="deleteComment" parameterType="_int">
		delete from comments where commentsId = #{commentsId}
	</delete>
	
	<update id="updateComment" parameterType="CommentsDTO">
		update comments 
		set content = #{content}, regdate = NOW(), secret = #{secret}
		where commentsId = #{commentsId} 
	</update>
	
	<select id="getCommentList" parameterType="map" resultType="CommentsDTO">
		select * from comments where bno = #{bno} and comment_type = #{comment_type}
		order by commentsId DESC
	</select>
	
</mapper>